<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Restaurante Gaucho - Delivery</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#0ea5b7; /* teal-500 vibe */
      --brand-dark:#0b8b9a;
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --accent:#22c55e; /* green-500 */
      --warn:#f59e0b; /* amber-500 */
      --danger:#ef4444; /* red-500 */
    }
    body{background: radial-gradient(1200px 600px at 20% 0%, #0b1223 0%, #0a0f1d 40%, #0a0f1d 100%), var(--bg);}
    .glass{backdrop-filter: blur(10px)}
    .shadow-soft{box-shadow: 0 10px 30px rgba(0,0,0,.35)}
    .btn{transition: transform .12s ease, box-shadow .2s ease}
    .btn:active{transform: translateY(1px)}
    .chip.active{outline: 2px solid var(--brand); outline-offset: 2px}
    .pulse-once{animation: pulse-once .5s ease}
    @keyframes pulse-once{
      0%{transform: scale(1)}
      50%{transform: scale(1.04)}
      100%{transform: scale(1)}
    }
    /* Scrolls */
    ::-webkit-scrollbar{height:10px;width:10px}
    ::-webkit-scrollbar-thumb{background:#1f2937;border-radius:8px}
    ::-webkit-scrollbar-track{background:#0b1223}
  </style>
</head>
<body class="min-h-screen text-slate-100 font-Inter">
  <!-- Header -->
  <header class="sticky top-0 z-30 bg-gradient-to-b from-[#0b1223]/90 to-transparent backdrop-blur border-b border-white/5">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <!-- Logo SVG -->
        <div class="w-12 h-12 rounded-xl bg-[var(--brand)] grid place-items-center shadow-soft">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" class="text-white">
            <path d="M3 21h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M7 21V8a5 5 0 0 1 10 0v13" stroke="currentColor" stroke-width="1.5"/>
            <path d="M9.5 11h5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1 class="text-2xl font-bold tracking-tight">Restaurante Gaucho</h1>
          <p class="text-sm text-[var(--muted)]">Churrasco, massas e delicias e Delivery</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button id="btnAdmin" class="btn px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 border border-white/10">area Admin</button>
        <button id="btnCart" class="btn relative px-4 py-2 rounded-lg bg-[var(--brand)] hover:bg-[var(--brand-dark)] shadow-soft">
          Carrinho
          <span id="cartCount" class="absolute -top-2 -right-2 text-xs bg-[var(--accent)] text-black rounded-full px-2 py-0.5">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-4 pt-8 pb-4">
    <div class="rounded-2xl p-6 md:p-8 bg-gradient-to-br from-[#0b1223] to-[#0a0f1d] border border-white/5 shadow-soft">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
        <div>
          <h2 class="text-3xl md:text-4xl font-bold">Pedido rapido e facil</h2>
          <p class="text-[var(--muted)] mt-2">Escolha seus pratos, informe entrega e finalize pelo WhatsApp: 11 93942-6652</p>
          <div class="flex items-center gap-3 mt-4">
            <a href="https://wa.me/5511939426652" target="_blank" class="btn inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#25D366] text-black hover:brightness-95">
              WhatsApp
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M16 8l5 4-5 4V8z" fill="currentColor"/>
                <path d="M2 12h19" stroke="currentColor" stroke-width="2" />
              </svg>
            </a>
            <span class="text-xs text-[var(--muted)]">Suporte: ter-dom 9h-16h</span>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3 w-full md:w-auto">
          <div class="rounded-xl p-4 bg-white/5 border border-white/10">
            <p class="text-sm text-[var(--muted)]">Taxas</p>
            <p class="font-semibold">A partir de R$ 3,00</p>
          </div>
          <div class="rounded-xl p-4 bg-white/5 border border-white/10">
            <p class="text-sm text-[var(--muted)]">Pagamento</p>
            <p class="font-semibold">Dinheiro , Pix , Credito , Debito</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Layout -->
  <main class="max-w-6xl mx-auto px-4 pb-24 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Menu -->
    <section class="lg:col-span-2">
      <!-- Category Tabs -->
      <div id="categoryTabs" class="flex gap-2 overflow-x-auto pb-2"></div>

      <!-- Search -->
      <div class="mt-4 flex items-center gap-3">
        <div class="flex-1 relative">
          <input id="searchInput" type="text" placeholder="Buscar no cardapio..." class="w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:ring-2 focus:ring-[var(--brand)]"/>
          <span class="absolute right-3 top-1/2 -translate-y-1/2 text-[var(--muted)] text-sm">?</span>
        </div>
        <button id="clearSearch" class="btn px-3 py-3 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10">Limpar</button>
      </div>

      <!-- Items Grid -->
      <div id="menuGrid" class="mt-4 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
    </section>

    <!-- Cart Sidebar -->
    <aside class="lg:sticky lg:top-24 h-max">
      <div class="rounded-2xl p-5 bg-[var(--card)]/90 glass border border-white/10 shadow-soft">
        <h3 class="text-xl font-semibold">Seu Pedido</h3>
        <div id="cartList" class="mt-3 space-y-3 max-h-72 overflow-auto pr-1"></div>
        <div class="mt-4 border-t border-white/10 pt-3 space-y-2">
          <div class="flex items-center justify-between text-sm text-[var(--muted)]">
            <span>Subtotal</span><span id="subtotal">R$ 0,00</span>
          </div>
          <div class="flex items-center justify-between text-sm text-[var(--muted)]">
            <span>Taxa de Entrega</span><span id="deliveryFee">R$ 0,00</span>
          </div>
          <div class="flex items-center justify-between text-base font-semibold">
            <span>Total</span><span id="total">R$ 0,00</span>
          </div>
        </div>

        <!-- Checkout Form -->
        <div class="mt-4 space-y-3">
          <input id="nome" class="w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Nome do cliente" />
          <input id="telefone" class="w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Telefone" />
          <input id="rua" class="w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Rua" />
          <div class="flex gap-2">
            <input id="numero" class="w-1/3 rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Numero" />
            <input id="referencia" class="flex-1 rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Ponto de referencia" />
          </div>
          <select id="bairro" class="w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2">
            <option value="">Selecione o bairro</option>
          </select>
          <select id="pagamento" class="w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2">
            <option value="">Forma de pagamento</option>
            <option>Dinheiro</option>
            <option>Pix</option>
            <option>Credito</option>
            <option>Debito</option>
          </select>
          <input id="troco" class="w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Troco para quanto? (se dinheiro)" />
          <button id="btnCheckout" class="btn w-full px-4 py-3 rounded-xl bg-[var(--accent)] text-black font-semibold hover:brightness-95">Finalizar no WhatsApp</button>
          <button id="btnReport" class="btn w-full px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">Gerar Relatorio</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- Admin Modal (Demo) -->
  <div id="adminModal" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative max-w-5xl mx-auto mt-12 mb-12 bg-[var(--card)] border border-white/10 rounded-2xl p-6 glass shadow-soft">
      <div class="flex items-center justify-between">
        <h3 class="text-2xl font-semibold">area Administrativa (Demo)</h3>
        <button id="closeAdmin" class="btn px-3 py-2 rounded-lg bg-white/10 border border-white/10 hover:bg-white/15">Fechar</button>
      </div>

      <!-- Simple Lock -->
      <div id="adminLock" class="mt-4">
        <p class="text-[var(--muted)] mb-2">Informe a senha para editar (apenas demonstracao, nao e seguro):</p>
        <div class="flex gap-2">
          <input id="adminPass" type="password" class="flex-1 rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Senha demo"/>
          <button id="unlock" class="btn px-4 py-2 rounded-lg bg-[var(--brand)] hover:bg-[var(--brand-dark)]">Desbloquear</button>
        </div>
        <p class="text-xs text-[var(--muted)] mt-2">Senha solicitada:  ()</p>
      </div>

      <div id="adminPanel" class="mt-6 hidden">
        <div class="grid md:grid-cols-3 gap-4">
          <div class="md:col-span-1 p-4 rounded-xl bg-white/5 border border-white/10">
            <h4 class="font-semibold">Categorias</h4>
            <ul id="catList" class="mt-2 space-y-2 text-sm"></ul>
            <div class="mt-3 flex gap-2">
              <input id="newCatName" class="flex-1 rounded-lg bg-white/5 border border-white/10 px-3 py-2" placeholder="Nova categoria"/>
              <button id="addCat" class="btn px-3 py-2 rounded-lg bg-[var(--accent)] text-black">Adicionar</button>
            </div>
          </div>
          <div class="md:col-span-2 p-4 rounded-xl bg-white/5 border border-white/10">
            <div class="flex items-center justify-between">
              <h4 class="font-semibold">Produtos</h4>
              <button id="addItem" class="btn px-3 py-2 rounded-lg bg-[var(--brand)] hover:bg-[var(--brand-dark)]">Novo Produto</button>
            </div>
            <div id="adminItems" class="mt-3 grid sm:grid-cols-2 gap-3 max-h-[50vh] overflow-auto pr-1"></div>
          </div>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
          <button id="exportData" class="btn px-4 py-2 rounded-lg bg-white/10 border border-white/10 hover:bg-white/15">Exportar dados</button>
          <label class="btn px-4 py-2 rounded-lg bg-white/10 border border-white/10 hover:bg-white/15 cursor-pointer">
            Importar dados
            <input id="importFile" type="file" accept="application/json" class="hidden"/>
          </label>
          <button id="resetData" class="btn px-4 py-2 rounded-lg bg-[var(--danger)] hover:brightness-110">Restaurar cardapio padrao</button>
        </div>
        <p class="text-xs text-[var(--muted)] mt-2">Dica: apos editar, clique em  Exportar dados  e salve o JSON para usar depois no GitHub Pages.</p>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white px-4 py-2 rounded-lg hidden"></div>

  <script>
    // ================== Data Model (with defaults) ==================
    const defaultData = {
      restaurant: {
        name: "Restaurante Gaucho",
        whatsapp: "5511939426652"
      },
      deliveryFees: [
        {bairro: "Vargem Grande", valor: 3.00},
        {bairro: "Silveira", valor: 5.00},
        {bairro: "Colonia", valor: 5.00},
        {bairro: "Parelheiros", valor: 10.00},
        {bairro: "Jd America", valor: 15.00},
        {bairro: "Outros", valor: 25.00}
      ],
      categories: [
        { id: id(), name: "MARMITEX" },
        { id: id(), name: "FEIJOADA LIGHT" },
        { id: id(), name: "MASSAS ITALIANAS" },
        { id: id(), name: "PORCAO" },
        { id: id(), name: "REFRIGERANTES" },
        { id: id(), name: "CARNES POR PESO" }
      ],
      items: [
        // MARMITEX
        item("Costela no Bafo", "MARMITEX", [{t:"P",p:28},{t:"G",p:32}]),
        item("Brisket", "MARMITEX", [{t:"P",p:28},{t:"G",p:32}]),
        item("Fraldinha Texana", "MARMITEX", [{t:"P",p:28},{t:"G",p:32}]),
        item("File de frango grelhado", "MARMITEX", [{t:"P",p:20},{t:"G",p:23}]),
        item("Calabresa acebolada", "MARMITEX", [{t:"P",p:23},{t:"G",p:26}]),
        item("Bife em tiras com fritas", "MARMITEX", [{t:"P",p:26},{t:"G",p:28}]),
        item("Bife acebolado", "MARMITEX", [{t:"P",p:26},{t:"G",p:28}]),
        item("Omelete (Tomate, Cebola e queijo)", "MARMITEX", [{t:"P",p:22},{t:"G",p:25}]),
        item("File de frango a milanesa", "MARMITEX", [{t:"P",p:23},{t:"G",p:27}]),
        item("Bife a milanesa", "MARMITEX", [{t:"P",p:27},{t:"G",p:30}]),
        item("Parmegiana de frango", "MARMITEX", [{t:"P",p:26},{t:"G",p:28}]),
        item("Parmegiana de carne", "MARMITEX", [{t:"P",p:29},{t:"G",p:32}]),
        item("Frango Assado", "MARMITEX", [{t:"P",p:23},{t:"G",p:26}]),
        item("Linguica", "MARMITEX", [{t:"P",p:23},{t:"G",p:26}]),
        // FEIJOADA
        item("Feijoada Light", "FEIJOADA LIGHT", [{t:"P",p:35},{t:"M",p:65},{t:"G",p:95}], "Acompanha Farofa, Couve, Torresmo, vinagrete, bisteca, banana, gomo de laranja, molho de pimenta e caipirinha. (S�bados)"),
        // MASSAS
        item("Rondelli Presunto e Queijo", "MASSAS ITALIANAS", [{t:"unico",p:30}]),
        item("Rondelli Verde 4 Queijos", "MASSAS ITALIANAS", [{t:"unico",p:31.5}]),
        item("Torttelli Amarelo Bacon e Creanchees", "MASSAS ITALIANAS", [{t:"unico",p:31.5}]),
        item("Capeletti de Carne", "MASSAS ITALIANAS", [{t:"unico",p:28}]),
        item("Raviolli Branco Mussarela", "MASSAS ITALIANAS", [{t:"unico",p:28}]),
        item("Pastelzinho de Carne e Queijo (6 un.)", "MASSAS ITALIANAS", [{t:"unico",p:20}]),
        item("Sorrentino Presunto e Mussarela", "MASSAS ITALIANAS", [{t:"unico",p:30}]),
        item("Conchigliione 5 Queijos", "MASSAS ITALIANAS", [{t:"unico",p:31.5}]),
        item("Nhoque de Batata", "MASSAS ITALIANAS", [{t:"unico",p:25}]),
        item("Adicional Arroz", "MASSAS ITALIANAS", [{t:"unico",p:10}]),
        item("Adicional Feijao", "MASSAS ITALIANAS", [{t:"unico",p:10}]),
        // PORCAO
        item("Carne assada", "PORCAO", [{t:"unico",p:30}]),
        item("Contra file", "PORCAO", [{t:"unico",p:45}]),
        item("Calabresa", "PORCAO", [{t:"unico",p:35}]),
        item("Mandioca", "PORCAO", [{t:"unico",p:20}]),
        item("Polenta", "PORCAO", [{t:"unico",p:15}]),
        item("Bolinho de Mandioca", "PORCAO", [{t:"unico",p:15}]),
        item("Aneis de Cebola", "PORCAO", [{t:"unico",p:15}]),
        item("Batata Frita", "PORCAO", [{t:"unico",p:25}]),
        item("Arroz", "PORCAO", [{t:"unico",p:20}]),
        item("Feijao", "PORCAO", [{t:"unico",p:15}]),
        item("Pao com Carne Assada", "PORCAO", [{t:"unico",p:15}]),
        // REFRIGERANTES
        item("Refrigerante Lata", "REFRIGERANTES", [{t:"350ml",p:6}]),
        item("H2O", "REFRIGERANTES", [{t:"",p:7}]),
        item("Coca-Cola 600ml", "REFRIGERANTES", [{t:"600ml",p:9}]),
        item("Coca-Cola 1L", "REFRIGERANTES", [{t:"1L",p:12}]),
        item("Coca-Cola 2L", "REFRIGERANTES", [{t:"2L",p:15}]),
        item("Coca-Cola 2,5L", "REFRIGERANTES", [{t:"2,5L",p:17}]),
        item("Refrigerantes 2L (diversos)", "REFRIGERANTES", [{t:"2L",p:12}]),
        item("Dolly 350ml", "REFRIGERANTES", [{t:"350ml",p:4}]),
        item("Tubaina 2L", "REFRIGERANTES", [{t:"2L",p:12}]),
        item("Fanta 600ml", "REFRIGERANTES", [{t:"600ml",p:9}]),
        // CARNES POR PESO
        item("Fraldinha Texana (porcao/meio/kg)", "CARNES POR PESO", [{t:"Porcao",p:30},{t:"Meio Kilo",p:40},{t:"Kilo",p:80}]),
        item("Costela no Bafo (porcao/meio/kg)", "CARNES POR PESO", [{t:"Porcao",p:30},{t:"Meio Kilo",p:40},{t:"Kilo",p:80}]),
        item("Brisket (ponta do peito) (porcao/meio/kg)", "CARNES POR PESO", [{t:"Porcao",p:30},{t:"Meio Kilo",p:40},{t:"Kilo",p:80}]),
      ]
    };

    function id(){ return Math.random().toString(36).slice(2,9) }
    function item(name, category, variants, note=""){
      return { id: id(), name, category, variants, note }
    }

    // Persistencia local
    const STORAGE_KEY = "gaucho_data_v1";
    function loadData(){
      const saved = localStorage.getItem(STORAGE_KEY);
      if(saved){
        try { return JSON.parse(saved) } catch(e){ console.warn(e) }
      }
      return defaultData;
    }
    function saveData(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DB)) }

    let DB = loadData();

    // ================== UI Bindings ==================
    const categoryTabs = document.getElementById('categoryTabs');
    const menuGrid = document.getElementById('menuGrid');
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');
    const cartList = document.getElementById('cartList');
    const subtotalEl = document.getElementById('subtotal');
    const deliveryFeeEl = document.getElementById('deliveryFee');
    const totalEl = document.getElementById('total');
    const bairroSel = document.getElementById('bairro');
    const pagamentoSel = document.getElementById('pagamento');
    const nomeInp = document.getElementById('nome');
    const telInp = document.getElementById('telefone');
    const ruaInp = document.getElementById('rua');
    const numeroInp = document.getElementById('numero');
    const refInp = document.getElementById('referencia');
    const trocoInp = document.getElementById('troco');
    const btnCheckout = document.getElementById('btnCheckout');
    const btnReport = document.getElementById('btnReport');
    const cartCount = document.getElementById('cartCount');
    const btnAdmin = document.getElementById('btnAdmin');
    const btnCart = document.getElementById('btnCart');
    const toast = document.getElementById('toast');

    // Admin
    const adminModal = document.getElementById('adminModal');
    const closeAdmin = document.getElementById('closeAdmin');
    const adminLock = document.getElementById('adminLock');
    const adminPanel = document.getElementById('adminPanel');
    const adminPass = document.getElementById('adminPass');
    const unlock = document.getElementById('unlock');
    const catList = document.getElementById('catList');
    const newCatName = document.getElementById('newCatName');
    const addCat = document.getElementById('addCat');
    const adminItems = document.getElementById('adminItems');
    const exportDataBtn = document.getElementById('exportData');
    const importFile = document.getElementById('importFile');
    const resetDataBtn = document.getElementById('resetData');

    // ================== Business Logic ==================
    let currentCategory = "Todos";
    let cart = []; // {key, itemId, name, variant, price, qty}

    function fmt(n){ return n.toLocaleString('pt-BR',{style:'currency', currency:'BRL'}) }

    function uniqueCategories(){
      const base = [{id:"all", name:"Todos"}];
      const cats = DB.categories.map(c=>({id:c.id, name:c.name}));
      return base.concat(cats);
    }

    function renderCategories(){
      categoryTabs.innerHTML = "";
      uniqueCategories().forEach(cat=>{
        const b = document.createElement('button');
        b.className = "chip btn px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 text-sm";
        b.textContent = cat.name;
        if(cat.name === currentCategory) b.classList.add('active');
        b.addEventListener('click', ()=>{
          currentCategory = cat.name;
          renderCategories();
          renderMenu();
          categoryTabs.scrollTo({left:0, behavior:"smooth"});
        });
        categoryTabs.appendChild(b);
      });
    }

    function renderMenu(){
      const q = searchInput.value.trim().toLowerCase();
      const items = DB.items.filter(it=>{
        const inCat = currentCategory==="Todos" ? true : it.category===currentCategory;
        const inSearch = q ? (it.name.toLowerCase().includes(q) || (it.note||"").toLowerCase().includes(q)) : true;
        return inCat && inSearch;
      });

      menuGrid.innerHTML = "";
      items.forEach(it=>{
        const card = document.createElement('div');
        card.className = "rounded-xl p-4 bg-white/5 border border-white/10 hover:border-[var(--brand)]/40 transition";
        const variantsHtml = it.variants.map(v => `
          <button data-vid="${v.t}" data-price="${v.p}" class="variant btn px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 text-sm">
            ${it.variants.length>1 && v.t ? `<span class="text-[var(--muted)]">${v.t}</span> ` : ""}<span class="font-semibold">${fmt(v.p)}</span>
          </button>
        `).join("");

        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <h4 class="font-semibold">${it.name}</h4>
              ${it.note ? `<p class="text-xs text-[var(--muted)] mt-1">${it.note}</p>`:""}
              <div class="mt-3 flex flex-wrap gap-2">${variantsHtml}</div>
            </div>
            <button class="fav w-10 h-10 rounded-lg grid place-items-center bg-white/5 border border-white/10 text-[var(--muted)] hover:text-white" title="Selecionar">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="8" class="icon-fill" />
              </svg>
            </button>
          </div>
        `;

        // Favorite highlight toggled when item is in cart
        const favBtn = card.querySelector('.fav');
        function updateFav(){
          const anyInCart = cart.some(c=>c.itemId===it.id);
          const fill = favBtn.querySelector('.icon-fill');
          if(anyInCart){
            favBtn.classList.add('pulse-once');
            favBtn.style.backgroundColor = 'rgba(34,197,94,0.15)';
            favBtn.style.borderColor = 'rgba(34,197,94,0.35)';
            fill.setAttribute('fill', '#22c55e');
          }else{
            favBtn.style.backgroundColor = '';
            favBtn.style.borderColor = '';
            favBtn.querySelector('.icon-fill').setAttribute('fill', 'currentColor');
          }
          setTimeout(()=>favBtn.classList.remove('pulse-once'), 400);
        }
        updateFav();
        favBtn.addEventListener('click', ()=>{
          // Toggle: se tem no carrinho, remove um de cada
          const idx = cart.findIndex(c=>c.itemId===it.id);
          if(idx>=0){
            cart.splice(idx,1);
            updateCart();
            toastMsg("Removido do carrinho");
          } else {
            // se tiver m�ltiplos tamanhos, adiciona primeiro
            const v0 = it.variants[0];
            addToCart(it, v0.t || "�nico", v0.p);
          }
          updateFav();
        });

        // Variant buttons
        card.querySelectorAll('.variant').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const variant = btn.getAttribute('data-vid') || "�nico";
            const price = parseFloat(btn.getAttribute('data-price'));
            addToCart(it, variant, price);
            // Visual feedback: color the clicked variant briefly
            btn.style.backgroundColor = 'rgba(34,197,94,0.2)';
            setTimeout(()=>btn.style.backgroundColor = '', 250);
            updateFav();
          });
        });

        menuGrid.appendChild(card);
      });
    }

    function renderBairros(){
      bairroSel.innerHTML = '<option value="">Selecione o bairro</option>';
      DB.deliveryFees.forEach(f=>{
        const opt = document.createElement('option');
        opt.value = f.bairro;
        opt.textContent = `${f.bairro} (${fmt(f.valor)})`;
        bairroSel.appendChild(opt);
      });
    }

    function addToCart(it, variant, price){
      const key = `${it.id}-${variant}`;
      const existing = cart.find(c=>c.key===key);
      if(existing){ existing.qty += 1; }
      else{ cart.push({key, itemId: it.id, name: it.name, variant, price, qty:1}); }
      updateCart();
      toastMsg("Adicionado ao carrinho");
    }

    function updateCart(){
      // selective update
      cartList.innerHTML = "";
      cart.forEach(ci=>{
        const row = document.createElement('div');
        row.className = "rounded-lg p-3 bg-white/5 border border-white/10";
        row.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="font-semibold">${ci.name} <span class="text-xs text-[var(--muted)]">${ci.variant? `� ${ci.variant}`:""}</span></p>
              <p class="text-sm text-[var(--muted)]">Unit�rio: ${fmt(ci.price)}</p>
            </div>
            <div class="flex items-center gap-2">
              <button class="btnDec w-8 h-8 rounded-lg bg-white/5 border border-white/10">-</button>
              <span class="w-6 text-center">${ci.qty}</span>
              <button class="btnInc w-8 h-8 rounded-lg bg-white/5 border border-white/10">+</button>
              <button class="btnDel w-8 h-8 rounded-lg bg-white/5 border border-white/10 text-red-400" title="Remover">x</button>
            </div>
          </div>
        `;
        row.querySelector('.btnDec').addEventListener('click', ()=>{
          ci.qty = Math.max(1, ci.qty-1);
          updateCart();
        });
        row.querySelector('.btnInc').addEventListener('click', ()=>{
          ci.qty += 1; updateCart();
        });
        row.querySelector('.btnDel').addEventListener('click', ()=>{
          cart = cart.filter(c=>c.key!==ci.key);
          updateCart();
          renderMenu(); // atualiza �cone do item
        });
        cartList.appendChild(row);
      });

      const subtotal = cart.reduce((s,c)=>s + c.price*c.qty, 0);
      subtotalEl.textContent = fmt(subtotal);

      const fee = calcFee(bairroSel.value);
      deliveryFeeEl.textContent = fmt(fee);

      totalEl.textContent = fmt(subtotal + fee);
      cartCount.textContent = cart.reduce((s,c)=>s+c.qty,0);
    }

    function calcFee(bairro){
      const f = DB.deliveryFees.find(d=>d.bairro===bairro);
      return f ? f.valor : 0;
    }

    function buildOrderMessage(){
      const lines = [];
      lines.push(`?? Pedido - ${DB.restaurant.name}`);
      lines.push(`----------------------`);
      cart.forEach(ci=>{
        lines.push(`� ${ci.name} ${ci.variant? '('+ci.variant+') ':''}x${ci.qty} - ${fmt(ci.price*ci.qty)}`);
      });
      const sub = cart.reduce((s,c)=>s+c.price*c.qty,0);
      const fee = calcFee(bairroSel.value);
      lines.push(`Subtotal: ${fmt(sub)}`);
      lines.push(`Entrega (${bairroSel.value||'�'}): ${fmt(fee)}`);
      lines.push(`Total: ${fmt(sub+fee)}`);
      lines.push(`----------------------`);
      lines.push(`Cliente: ${nomeInp.value||'�'}`);
      lines.push(`Telefone: ${telInp.value||'�'}`);
      lines.push(`Endere�o: ${ruaInp.value||'�'}, ${numeroInp.value||'�'}`);
      lines.push(`Refer�ncia: ${refInp.value||'�'}`);
      lines.push(`Pagamento: ${pagamentoSel.value||'�'}` + (pagamentoSel.value==="Dinheiro" && trocoInp.value? ` (Troco: ${trocoInp.value})`:""));
      return lines.join('%0A');
    }

    // WhatsApp Checkout
    btnCheckout.addEventListener('click', ()=>{
      if(cart.length===0){ toastMsg("Adicione itens ao carrinho"); return }
      if(!bairroSel.value){ toastMsg("Selecione o bairro"); return }
      if(!pagamentoSel.value){ toastMsg("Informe a forma de pagamento"); return }
      const msg = buildOrderMessage();
      const phone = DB.restaurant.whatsapp || "5511939426652";
      const url = `https://wa.me/${phone}?text=${msg}`;
      window.open(url, "_blank");
    });

    // Report
    btnReport.addEventListener('click', ()=>{
      if(cart.length===0){ toastMsg("Carrinho vazio"); return }
      const date = new Date().toLocaleString('pt-BR');
      const rows = cart.map(ci=>({
        produto: ci.name,
        variante: ci.variant,
        quantidade: ci.qty,
        unitario: ci.price,
        total: ci.price*ci.qty
      }));
      const fee = calcFee(bairroSel.value);
      const sum = rows.reduce((s,r)=>s+r.total,0);
      const report = {
        restaurante: DB.restaurant.name,
        data: date,
        cliente: nomeInp.value || "",
        telefone: telInp.value || "",
        rua: ruaInp.value || "",
        numero: numeroInp.value || "",
        referencia: refInp.value || "",
        bairro: bairroSel.value || "",
        pagamento: pagamentoSel.value || "",
        taxaEntrega: fee,
        subtotal: sum,
        total: sum+fee,
        itens: rows
      };
      const blob = new Blob([JSON.stringify(report, null, 2)], {type:"application/json"});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `relatorio-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
      toastMsg("Relatorio baixado");
    });

    // Search
    searchInput.addEventListener('input', renderMenu);
    clearSearch.addEventListener('click', ()=>{ searchInput.value=""; renderMenu(); });

    // Bairro change
    bairroSel.addEventListener('change', updateCart);

    // Cart quick open visual (scroll to aside)
    btnCart.addEventListener('click', ()=>{
      window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
      toastMsg("Role ate a area de pedido");
    });

    // Admin Modal control
    btnAdmin.addEventListener('click', ()=> adminModal.classList.remove('hidden'));
    closeAdmin.addEventListener('click', ()=> adminModal.classList.add('hidden'));
    unlock.addEventListener('click', ()=>{
      // Demo lock only (not secure)
      if(adminPass.value === "170183Mf"){
        adminLock.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        buildAdmin();
      }else{
        toastMsg("Senha incorreta (demo)");
      }
    });

    // Admin functions
    function buildAdmin(){
      // Categories
      catList.innerHTML = "";
      DB.categories.forEach(c=>{
        const li = document.createElement('li');
        li.className = "flex items-center justify-between gap-2 bg-white/5 border border-white/10 rounded-lg px-3 py-2";
        li.innerHTML = `
          <input class="name flex-1 bg-transparent outline-none" value="${c.name}"/>
          <div class="flex gap-2">
            <button class="btnSave px-2 py-1 text-xs rounded bg-[var(--accent)] text-black">Salvar</button>
            <button class="btnDel px-2 py-1 text-xs rounded bg-[var(--danger)]">Excluir</button>
          </div>
        `;
        li.querySelector('.btnSave').addEventListener('click', ()=>{
          const nv = li.querySelector('.name').value.trim();
          if(!nv){ toastMsg("Nome da categoria vazio"); return }
          c.name = nv;
          saveData(); renderCategories(); renderMenu(); toastMsg("Categoria atualizada");
        });
        li.querySelector('.btnDel').addEventListener('click', ()=>{
          if(!confirm("Excluir categoria e seus v�nculos?")) return;
          DB.items = DB.items.filter(it=>it.category!==c.name);
          DB.categories = DB.categories.filter(x=>x.id!==c.id);
          saveData(); buildAdmin(); renderCategories(); renderMenu(); toastMsg("Categoria exclu�da");
        });
        catList.appendChild(li);
      });

      // Add Category
      addCat.onclick = ()=>{
        const name = newCatName.value.trim();
        if(!name) return toastMsg("Informe um nome");
        DB.categories.push({id:id(), name});
        newCatName.value="";
        saveData(); buildAdmin(); renderCategories(); renderMenu(); toastMsg("Categoria criada");
      };

      // Items
      adminItems.innerHTML = "";
      DB.items.forEach(it=>{
        const wrap = document.createElement('div');
        wrap.className = "rounded-lg p-3 bg-white/5 border border-white/10";
        const variantsStr = it.variants.map(v=>`${v.t}|${v.p}`).join(','); // "P|28,G|32"
        wrap.innerHTML = `
          <div class="space-y-2">
            <input class="iName w-full rounded bg-white/5 border border-white/10 px-2 py-1" value="${it.name}" />
            <select class="iCat w-full rounded bg-white/5 border border-white/10 px-2 py-1">
              ${DB.categories.map(c=>`<option ${c.name===it.category?'selected':''}>${c.name}</option>`).join("")}
            </select>
            <input class="iNote w-full rounded bg-white/5 border border-white/10 px-2 py-1" placeholder="Observa��o (opcional)" value="${it.note||''}" />
            <input class="iVar w-full rounded bg-white/5 border border-white/10 px-2 py-1 text-sm" placeholder="Formatos: Tamanho|Pre�o,..." value="${variantsStr}" />
            <div class="flex gap-2">
              <button class="save btn px-3 py-2 rounded bg-[var(--accent)] text-black">Salvar</button>
              <button class="del btn px-3 py-2 rounded bg-[var(--danger)]">Excluir</button>
            </div>
          </div>
        `;
        wrap.querySelector('.save').addEventListener('click', ()=>{
          it.name = wrap.querySelector('.iName').value.trim() || it.name;
          it.category = wrap.querySelector('.iCat').value;
          it.note = wrap.querySelector('.iNote').value.trim();
          const vs = wrap.querySelector('.iVar').value.split(',').map(s=>s.trim()).filter(Boolean).map(p=>{
            const [t,price] = p.split('|');
            return {t:t||"�nico", p: Number(price)||0};
          });
          if(vs.length===0){ toastMsg("Adicione ao menos um formato"); return }
          it.variants = vs;
          saveData(); renderCategories(); renderMenu(); toastMsg("Produto salvo");
        });
        wrap.querySelector('.del').addEventListener('click', ()=>{
          if(!confirm("Excluir este produto?")) return;
          DB.items = DB.items.filter(x=>x.id!==it.id);
          saveData(); buildAdmin(); renderMenu(); toastMsg("Produto exclu�do");
        });
        adminItems.appendChild(wrap);
      });

      // Add Item
      document.getElementById('addItem').onclick = ()=>{
        const catName = DB.categories[0]?.name || "Sem categoria";
        DB.items.push(item("Novo Produto", catName, [{t:"�nico", p:0}]));
        saveData(); buildAdmin(); renderMenu(); toastMsg("Produto adicionado");
      };

      // Export / Import / Reset
      exportDataBtn.onclick = ()=>{
        const blob = new Blob([JSON.stringify(DB, null, 2)], {type:"application/json"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "gaucho-dados.json";
        a.click();
        URL.revokeObjectURL(a.href);
        toastMsg("Dados exportados");
      };
      importFile.onchange = (e)=>{
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          try{
            const data = JSON.parse(reader.result);
            if(!data.items || !data.categories) throw new Error("Estrutura invalida");
            DB = data;
            saveData();
            renderCategories(); renderMenu(); buildAdmin(); renderBairros();
            toastMsg("Dados importados");
          }catch(err){
            toastMsg("Falha ao importar");
          }
        };
        reader.readAsText(file);
      };
      resetDataBtn.onclick = ()=>{
        if(!confirm("Restaurar cardapio padrao? Isto substitui suas alteracoes locais.")) return;
        DB = JSON.parse(JSON.stringify(defaultData));
        saveData(); renderCategories(); renderMenu(); buildAdmin(); renderBairros();
        toastMsg("Cardapio restaurado");
      };
    }

    // Toast
    let toastTimer=null;
    function toastMsg(t){
      toast.textContent = t;
      toast.classList.remove('hidden');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toast.classList.add('hidden'), 1800);
    }

    // Init
    function init(){
      renderCategories();
      renderMenu();
      renderBairros();
      updateCart();
    }
    init();

    // ============ Helper: GitHub Deployment Hint ============
    // Para publicar no GitHub Pages: crie um repositorio, adicione este arquivo como index.html,
    // ative Pages (branch main / root) e pronto.
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97eac551055bcb3d',t:'MTc1Nzc5OTI4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>